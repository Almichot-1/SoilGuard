{
    "sourceFile": "lib/services/recommender_service.dart",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 5,
            "patches": [
                {
                    "date": 1765222295178,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1765291029756,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,6 +1,6 @@\n import 'dart:convert';\r\n-import 'dart:math';\r\n+import 'dart:math' as math;\r\n import 'package:flutter/services.dart';\r\n import '../models/crop.dart';\r\n import '../models/soil_data.dart';\r\n import '../models/recommendation.dart';\r\n@@ -62,19 +62,19 @@\n       // Outside range - calculate penalty\r\n       if (value < min) {\r\n         double distance = min - value;\r\n         double range = max - min;\r\n-        return max(0, 1 - (distance / range));\r\n+        return math.max(0, 1 - (distance / range));\r\n       } else {\r\n         double distance = value - max;\r\n         double range = max - min;\r\n-        return max(0, 1 - (distance / range));\r\n+        return math.max(0, 1 - (distance / range));\r\n       }\r\n     }\r\n     \r\n     // Within range - calculate how close to optimal\r\n     double distanceFromOptimal = (value - optimal).abs();\r\n-    double maxDistance = max((optimal - min).abs(), (max - optimal).abs());\r\n+    double maxDistance = math.max((optimal - min).abs(), (max - optimal).abs());\r\n     \r\n     if (maxDistance == 0) return 1.0;\r\n     \r\n     return 1 - (distanceFromOptimal / maxDistance) * 0.3; // Max 30% penalty for being at edges\r\n"
                },
                {
                    "date": 1765291231848,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,6 +1,6 @@\n import 'dart:convert';\r\n-import 'dart:math' as math;\r\n+import 'dart:math';\r\n import 'package:flutter/services.dart';\r\n import '../models/crop.dart';\r\n import '../models/soil_data.dart';\r\n import '../models/recommendation.dart';\r\n@@ -62,19 +62,19 @@\n       // Outside range - calculate penalty\r\n       if (value < min) {\r\n         double distance = min - value;\r\n         double range = max - min;\r\n-        return math.max(0, 1 - (distance / range));\r\n+        return max(0, 1 - (distance / range));\r\n       } else {\r\n         double distance = value - max;\r\n         double range = max - min;\r\n-        return math.max(0, 1 - (distance / range));\r\n+        return max(0, 1 - (distance / range));\r\n       }\r\n     }\r\n     \r\n     // Within range - calculate how close to optimal\r\n     double distanceFromOptimal = (value - optimal).abs();\r\n-    double maxDistance = math.max((optimal - min).abs(), (max - optimal).abs());\r\n+    double maxDistance = max((optimal - min).abs(), (max - optimal).abs());\r\n     \r\n     if (maxDistance == 0) return 1.0;\r\n     \r\n     return 1 - (distanceFromOptimal / maxDistance) * 0.3; // Max 30% penalty for being at edges\r\n"
                },
                {
                    "date": 1765291521733,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,6 +1,6 @@\n import 'dart:convert';\r\n-import 'dart:math';\r\n+import 'dart:math' as math;\r\n import 'package:flutter/services.dart';\r\n import '../models/crop.dart';\r\n import '../models/soil_data.dart';\r\n import '../models/recommendation.dart';\r\n@@ -62,19 +62,19 @@\n       // Outside range - calculate penalty\r\n       if (value < min) {\r\n         double distance = min - value;\r\n         double range = max - min;\r\n-        return max(0, 1 - (distance / range));\r\n+        return math.max(0, 1 - (distance / range));\r\n       } else {\r\n         double distance = value - max;\r\n         double range = max - min;\r\n-        return max(0, 1 - (distance / range));\r\n+        return math.max(0, 1 - (distance / range));\r\n       }\r\n     }\r\n     \r\n     // Within range - calculate how close to optimal\r\n     double distanceFromOptimal = (value - optimal).abs();\r\n-    double maxDistance = max((optimal - min).abs(), (max - optimal).abs());\r\n+    double maxDistance = math.max((optimal - min).abs(), (max - optimal).abs());\r\n     \r\n     if (maxDistance == 0) return 1.0;\r\n     \r\n     return 1 - (distanceFromOptimal / maxDistance) * 0.3; // Max 30% penalty for being at edges\r\n"
                },
                {
                    "date": 1765292179081,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -18,11 +18,12 @@\n       final jsonData = json.decode(jsonString) as Map<String, dynamic>;\r\n       final cropList = jsonData['crops'] as List<dynamic>;\r\n       \r\n       _crops = cropList.map((c) => Crop.fromJson(c as Map<String, dynamic>)).toList();\r\n-      print('Loaded ${_crops.length} crops');\r\n+      // Prefer debugPrint over print in production code\r\n+      debugPrint('Loaded ${_crops.length} crops');\r\n     } catch (e) {\r\n-      print('Error loading crops: $e');\r\n+      debugPrint('Error loading crops: $e');\r\n       _crops = [];\r\n     }\r\n   }\r\n \r\n"
                },
                {
                    "date": 1765292193416,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,6 +1,7 @@\n import 'dart:convert';\r\n import 'dart:math' as math;\r\n+import 'package:flutter/foundation.dart';\r\n import 'package:flutter/services.dart';\r\n import '../models/crop.dart';\r\n import '../models/soil_data.dart';\r\n import '../models/recommendation.dart';\r\n"
                }
            ],
            "date": 1765222295178,
            "name": "Commit-0",
            "content": "import 'dart:convert';\r\nimport 'dart:math';\r\nimport 'package:flutter/services.dart';\r\nimport '../models/crop.dart';\r\nimport '../models/soil_data.dart';\r\nimport '../models/recommendation.dart';\r\n\r\nclass RecommenderService {\r\n  List<Crop> _crops = [];\r\n  \r\n  List<Crop> get crops => List.unmodifiable(_crops);\r\n  bool get isLoaded => _crops.isNotEmpty;\r\n\r\n  /// Load crops from JSON asset\r\n  Future<void> loadCrops() async {\r\n    try {\r\n      final jsonString = await rootBundle.loadString('assets/data/crops.json');\r\n      final jsonData = json.decode(jsonString) as Map<String, dynamic>;\r\n      final cropList = jsonData['crops'] as List<dynamic>;\r\n      \r\n      _crops = cropList.map((c) => Crop.fromJson(c as Map<String, dynamic>)).toList();\r\n      print('Loaded ${_crops.length} crops');\r\n    } catch (e) {\r\n      print('Error loading crops: $e');\r\n      _crops = [];\r\n    }\r\n  }\r\n\r\n  /// Calculate suitability score for a crop given soil conditions\r\n  double _calculateScore(Crop crop, SoilData soil) {\r\n    // pH score (40% weight)\r\n    double phScore = _rangeScore(\r\n      soil.ph, \r\n      crop.phMin, \r\n      crop.phMax, \r\n      crop.phOptimal,\r\n    );\r\n    \r\n    // Moisture score (40% weight)\r\n    double moistureScore = _rangeScore(\r\n      soil.moisture,\r\n      crop.moistureMin,\r\n      crop.moistureMax,\r\n      crop.moistureOptimal,\r\n    );\r\n    \r\n    // Temperature score (20% weight)\r\n    double tempScore = _rangeScore(\r\n      soil.temperature,\r\n      crop.tempMin,\r\n      crop.tempMax,\r\n      crop.tempOptimal,\r\n    );\r\n    \r\n    // Weighted average\r\n    return (phScore * 0.4 + moistureScore * 0.4 + tempScore * 0.2) * 100;\r\n  }\r\n\r\n  /// Calculate how well a value fits within a range\r\n  double _rangeScore(double value, double min, double max, double optimal) {\r\n    if (value < min || value > max) {\r\n      // Outside range - calculate penalty\r\n      if (value < min) {\r\n        double distance = min - value;\r\n        double range = max - min;\r\n        return max(0, 1 - (distance / range));\r\n      } else {\r\n        double distance = value - max;\r\n        double range = max - min;\r\n        return max(0, 1 - (distance / range));\r\n      }\r\n    }\r\n    \r\n    // Within range - calculate how close to optimal\r\n    double distanceFromOptimal = (value - optimal).abs();\r\n    double maxDistance = max((optimal - min).abs(), (max - optimal).abs());\r\n    \r\n    if (maxDistance == 0) return 1.0;\r\n    \r\n    return 1 - (distanceFromOptimal / maxDistance) * 0.3; // Max 30% penalty for being at edges\r\n  }\r\n\r\n  /// Generate recommendations for given soil data and area\r\n  List<Recommendation> getRecommendations(SoilData soil, double areaHa) {\r\n    if (_crops.isEmpty) return [];\r\n\r\n    // Calculate scores for all crops\r\n    List<MapEntry<Crop, double>> scored = _crops\r\n        .map((crop) => MapEntry(crop, _calculateScore(crop, soil)))\r\n        .toList();\r\n    \r\n    // Sort by score descending\r\n    scored.sort((a, b) => b.value.compareTo(a.value));\r\n    \r\n    // Take top 3\r\n    return scored.take(3).map((entry) {\r\n      final crop = entry.key;\r\n      final score = entry.value;\r\n      \r\n      // Calculate planting requirements\r\n      final seedKg = crop.seedRateKgPerHa * areaHa;\r\n      final areaM2 = areaHa * 10000;\r\n      final plantSpaceM2 = (crop.rowSpacingCm / 100) * (crop.plantSpacingCm / 100);\r\n      final plantCount = (areaM2 / plantSpaceM2).round();\r\n      \r\n      return Recommendation(\r\n        crop: crop,\r\n        suitabilityPercent: score.clamp(0, 100),\r\n        seedKg: double.parse(seedKg.toStringAsFixed(2)),\r\n        plantCount: plantCount,\r\n        areaHa: areaHa,\r\n      );\r\n    }).toList();\r\n  }\r\n}"
        }
    ]
}