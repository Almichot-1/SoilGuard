{
    "sourceFile": "lib/services/db_service.dart",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 2,
            "patches": [
                {
                    "date": 1765222304152,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1765290332194,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -99,8 +99,15 @@\n       whereArgs: [id],\r\n     );\r\n   }\r\n \r\n+  /// Clear all scans and recommendations\r\n+  Future<void> clearAll() async {\r\n+    if (_database == null) await initialize();\r\n+    await _database!.delete('recommendations');\r\n+    await _database!.delete('soil_scans');\r\n+  }\r\n+\r\n   /// Get scan count\r\n   Future<int> getScanCount() async {\r\n     if (_database == null) await initialize();\r\n \r\n"
                },
                {
                    "date": 1765292114908,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,9 +1,7 @@\n import 'package:sqflite/sqflite.dart';\r\n import 'package:path/path.dart';\r\n import '../models/scan_result.dart';\r\n-import '../models/recommendation.dart';\r\n-import '../models/crop.dart';\r\n \r\n class DatabaseService {\r\n   Database? _database;\r\n   \r\n"
                }
            ],
            "date": 1765222304152,
            "name": "Commit-0",
            "content": "import 'package:sqflite/sqflite.dart';\r\nimport 'package:path/path.dart';\r\nimport '../models/scan_result.dart';\r\nimport '../models/recommendation.dart';\r\nimport '../models/crop.dart';\r\n\r\nclass DatabaseService {\r\n  Database? _database;\r\n  \r\n  bool get isInitialized => _database != null;\r\n\r\n  Future<void> initialize() async {\r\n    final dbPath = await getDatabasesPath();\r\n    final path = join(dbPath, 'soil_sense.db');\r\n\r\n    _database = await openDatabase(\r\n      path,\r\n      version: 1,\r\n      onCreate: (db, version) async {\r\n        await db.execute('''\r\n          CREATE TABLE soil_scans (\r\n            id INTEGER PRIMARY KEY AUTOINCREMENT,\r\n            avg_ph REAL NOT NULL,\r\n            avg_moisture REAL NOT NULL,\r\n            avg_temp REAL NOT NULL,\r\n            area_m2 REAL NOT NULL,\r\n            area_ha REAL NOT NULL,\r\n            gps_points TEXT,\r\n            timestamp TEXT NOT NULL\r\n          )\r\n        ''');\r\n\r\n        await db.execute('''\r\n          CREATE TABLE recommendations (\r\n            id INTEGER PRIMARY KEY AUTOINCREMENT,\r\n            scan_id INTEGER NOT NULL,\r\n            crop_name TEXT NOT NULL,\r\n            suitability_percent INTEGER NOT NULL,\r\n            seed_kg REAL NOT NULL,\r\n            spacing_cm TEXT NOT NULL,\r\n            plant_count INTEGER NOT NULL,\r\n            FOREIGN KEY (scan_id) REFERENCES soil_scans(id) ON DELETE CASCADE\r\n          )\r\n        ''');\r\n      },\r\n    );\r\n  }\r\n\r\n  /// Save a scan result with recommendations\r\n  Future<int> saveScanResult(ScanResult result) async {\r\n    if (_database == null) await initialize();\r\n\r\n    // Insert scan\r\n    final scanId = await _database!.insert('soil_scans', result.toDbMap());\r\n\r\n    // Insert recommendations\r\n    for (final rec in result.recommendations) {\r\n      await _database!.insert('recommendations', {\r\n        'scan_id': scanId,\r\n        'crop_name': rec.crop.name,\r\n        'suitability_percent': rec.suitabilityPercent.round(),\r\n        'seed_kg': rec.seedKg,\r\n        'spacing_cm': rec.spacing,\r\n        'plant_count': rec.plantCount,\r\n      });\r\n    }\r\n\r\n    return scanId;\r\n  }\r\n\r\n  /// Get all scan history\r\n  Future<List<Map<String, dynamic>>> getAllScans() async {\r\n    if (_database == null) await initialize();\r\n\r\n    return await _database!.query(\r\n      'soil_scans',\r\n      orderBy: 'timestamp DESC',\r\n    );\r\n  }\r\n\r\n  /// Get recommendations for a scan\r\n  Future<List<Map<String, dynamic>>> getRecommendations(int scanId) async {\r\n    if (_database == null) await initialize();\r\n\r\n    return await _database!.query(\r\n      'recommendations',\r\n      where: 'scan_id = ?',\r\n      whereArgs: [scanId],\r\n    );\r\n  }\r\n\r\n  /// Delete a scan and its recommendations\r\n  Future<void> deleteScan(int id) async {\r\n    if (_database == null) await initialize();\r\n\r\n    await _database!.delete(\r\n      'soil_scans',\r\n      where: 'id = ?',\r\n      whereArgs: [id],\r\n    );\r\n  }\r\n\r\n  /// Get scan count\r\n  Future<int> getScanCount() async {\r\n    if (_database == null) await initialize();\r\n\r\n    final result = await _database!.rawQuery('SELECT COUNT(*) as count FROM soil_scans');\r\n    return Sqflite.firstIntValue(result) ?? 0;\r\n  }\r\n}"
        }
    ]
}