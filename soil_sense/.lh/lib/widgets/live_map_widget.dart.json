{
    "sourceFile": "lib/widgets/live_map_widget.dart",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 4,
            "patches": [
                {
                    "date": 1765222324869,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1765292379725,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -43,9 +43,9 @@\n           PolygonLayer(\r\n             polygons: [\r\n               Polygon(\r\n                 points: trackPoints,\r\n-                color: AppColors.primary.withOpacity(0.2),\r\n+                color: AppColors.primary.withValues(alpha: 0.2),\r\n                 borderColor: AppColors.primary,\r\n                 borderStrokeWidth: 3,\r\n                 isFilled: true,\r\n               ),\r\n@@ -79,9 +79,9 @@\n                     shape: BoxShape.circle,\r\n                     border: Border.all(color: Colors.white, width: 3),\r\n                     boxShadow: [\r\n                       BoxShadow(\r\n-                        color: Colors.black.withOpacity(0.3),\r\n+                        color: Colors.black.withValues(alpha: 0.3),\r\n                         blurRadius: 4,\r\n                         offset: const Offset(0, 2),\r\n                       ),\r\n                     ],\r\n@@ -181,9 +181,9 @@\n           width: 40,\r\n           height: 40,\r\n           decoration: BoxDecoration(\r\n             shape: BoxShape.circle,\r\n-            color: Colors.blue.withOpacity(0.2 / _animation.value),\r\n+            color: Colors.blue.withValues(alpha: 0.2 / _animation.value),\r\n           ),\r\n           child: Center(\r\n             child: Container(\r\n               width: 20,\r\n@@ -193,9 +193,9 @@\n                 shape: BoxShape.circle,\r\n                 border: Border.all(color: Colors.white, width: 3),\r\n                 boxShadow: [\r\n                   BoxShadow(\r\n-                    color: Colors.blue.withOpacity(0.4),\r\n+                    color: Colors.blue.withValues(alpha: 0.4),\r\n                     blurRadius: 8,\r\n                     spreadRadius: 2,\r\n                   ),\r\n                 ],\r\n"
                },
                {
                    "date": 1765292402299,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -46,9 +46,10 @@\n                 points: trackPoints,\r\n                 color: AppColors.primary.withValues(alpha: 0.2),\r\n                 borderColor: AppColors.primary,\r\n                 borderStrokeWidth: 3,\r\n-                isFilled: true,\r\n+                // 'isFilled' deprecated; setting color enables filling\r\n+                // Remove deprecated property\r\n               ),\r\n             ],\r\n           ),\r\n         \r\n"
                },
                {
                    "date": 1765450213853,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -94,10 +94,11 @@\n                   ),\r\n                 ),\r\n               ),\r\n             \r\n-            // Intermediate points\r\n-            ...trackPoints.skip(1).take(trackPoints.length - 2).map(\r\n+            // Intermediate points (only when we have at least 3 points)\r\n+            ...(trackPoints.length > 2\r\n+                ? trackPoints.skip(1).take(trackPoints.length - 2).map(\r\n               (point) => Marker(\r\n                 point: point,\r\n                 width: 16,\r\n                 height: 16,\r\n@@ -108,9 +109,10 @@\n                     border: Border.all(color: Colors.white, width: 2),\r\n                   ),\r\n                 ),\r\n               ),\r\n-            ),\r\n+                )\r\n+                : const Iterable<Widget>.empty()),\r\n             \r\n             // Current location (blue pulsing)\r\n             if (currentLocation != null)\r\n               Marker(\r\n"
                },
                {
                    "date": 1765450240060,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,215 @@\n+import 'package:flutter/material.dart';\r\n+import 'package:flutter_map/flutter_map.dart';\r\n+import 'package:latlong2/latlong.dart';\r\n+import '../utils/constants.dart';\r\n+\r\n+class LiveMapWidget extends StatelessWidget {\r\n+  final List<LatLng> trackPoints;\r\n+  final LatLng? currentLocation;\r\n+  final bool isTracking;\r\n+  final MapController? mapController;\r\n+\r\n+  const LiveMapWidget({\r\n+    super.key,\r\n+    required this.trackPoints,\r\n+    this.currentLocation,\r\n+    this.isTracking = false,\r\n+    this.mapController,\r\n+  });\r\n+\r\n+  @override\r\n+  Widget build(BuildContext context) {\r\n+    final center = currentLocation ?? \r\n+        (trackPoints.isNotEmpty ? trackPoints.last : const LatLng(9.0, 38.75)); // Default: Addis Ababa\r\n+\r\n+    return FlutterMap(\r\n+      mapController: mapController,\r\n+      options: MapOptions(\r\n+        initialCenter: center,\r\n+        initialZoom: 18.0,\r\n+        maxZoom: 22.0,\r\n+        minZoom: 10.0,\r\n+      ),\r\n+      children: [\r\n+        // OpenStreetMap tiles\r\n+        TileLayer(\r\n+          urlTemplate: 'https://tile.openstreetmap.org/{z}/{x}/{y}.png',\r\n+          userAgentPackageName: 'com.example.soil_sense',\r\n+          maxZoom: 22,\r\n+        ),\r\n+        \r\n+        // Polygon fill (if we have enough points)\r\n+        if (trackPoints.length >= 3)\r\n+          PolygonLayer(\r\n+            polygons: [\r\n+              Polygon(\r\n+                points: trackPoints,\r\n+                color: AppColors.primary.withValues(alpha: 0.2),\r\n+                borderColor: AppColors.primary,\r\n+                borderStrokeWidth: 3,\r\n+                // 'isFilled' deprecated; setting color enables filling\r\n+                // Remove deprecated property\r\n+              ),\r\n+            ],\r\n+          ),\r\n+        \r\n+        // Track line\r\n+        if (trackPoints.length >= 2)\r\n+          PolylineLayer(\r\n+            polylines: [\r\n+              Polyline(\r\n+                points: trackPoints,\r\n+                color: AppColors.primary,\r\n+                strokeWidth: 4,\r\n+              ),\r\n+            ],\r\n+          ),\r\n+        \r\n+        // Track points markers\r\n+        MarkerLayer(\r\n+          markers: [\r\n+            // Start point (green)\r\n+            if (trackPoints.isNotEmpty)\r\n+              Marker(\r\n+                point: trackPoints.first,\r\n+                width: 30,\r\n+                height: 30,\r\n+                child: Container(\r\n+                  decoration: BoxDecoration(\r\n+                    color: Colors.green,\r\n+                    shape: BoxShape.circle,\r\n+                    border: Border.all(color: Colors.white, width: 3),\r\n+                    boxShadow: [\r\n+                      BoxShadow(\r\n+                        color: Colors.black.withValues(alpha: 0.3),\r\n+                        blurRadius: 4,\r\n+                        offset: const Offset(0, 2),\r\n+                      ),\r\n+                    ],\r\n+                  ),\r\n+                  child: const Icon(\r\n+                    Icons.play_arrow,\r\n+                    color: Colors.white,\r\n+                    size: 16,\r\n+                  ),\r\n+                ),\r\n+              ),\r\n+            \r\n+            // Intermediate points (only when we have at least 3 points)\r\n+            ...(trackPoints.length > 2\r\n+                ? trackPoints\r\n+                    .skip(1)\r\n+                    .take(trackPoints.length - 2)\r\n+                    .map<Marker>(\r\n+                      (point) => Marker(\r\n+                        point: point,\r\n+                        width: 16,\r\n+                        height: 16,\r\n+                        child: Container(\r\n+                          decoration: BoxDecoration(\r\n+                            color: AppColors.primary,\r\n+                            shape: BoxShape.circle,\r\n+                            border: Border.all(color: Colors.white, width: 2),\r\n+                          ),\r\n+                        ),\r\n+                      ),\r\n+                    )\r\n+                : const <Marker>[]),\r\n+            \r\n+            // Current location (blue pulsing)\r\n+            if (currentLocation != null)\r\n+              Marker(\r\n+                point: currentLocation!,\r\n+                width: 40,\r\n+                height: 40,\r\n+                child: _PulsingLocationMarker(isTracking: isTracking),\r\n+              ),\r\n+          ],\r\n+        ),\r\n+      ],\r\n+    );\r\n+  }\r\n+}\r\n+\r\n+class _PulsingLocationMarker extends StatefulWidget {\r\n+  final bool isTracking;\r\n+  \r\n+  const _PulsingLocationMarker({required this.isTracking});\r\n+\r\n+  @override\r\n+  State<_PulsingLocationMarker> createState() => _PulsingLocationMarkerState();\r\n+}\r\n+\r\n+class _PulsingLocationMarkerState extends State<_PulsingLocationMarker>\r\n+    with SingleTickerProviderStateMixin {\r\n+  late AnimationController _controller;\r\n+  late Animation<double> _animation;\r\n+\r\n+  @override\r\n+  void initState() {\r\n+    super.initState();\r\n+    _controller = AnimationController(\r\n+      duration: const Duration(seconds: 1),\r\n+      vsync: this,\r\n+    );\r\n+    _animation = Tween<double>(begin: 1.0, end: 1.5).animate(\r\n+      CurvedAnimation(parent: _controller, curve: Curves.easeInOut),\r\n+    );\r\n+    \r\n+    if (widget.isTracking) {\r\n+      _controller.repeat(reverse: true);\r\n+    }\r\n+  }\r\n+\r\n+  @override\r\n+  void didUpdateWidget(_PulsingLocationMarker oldWidget) {\r\n+    super.didUpdateWidget(oldWidget);\r\n+    if (widget.isTracking && !_controller.isAnimating) {\r\n+      _controller.repeat(reverse: true);\r\n+    } else if (!widget.isTracking && _controller.isAnimating) {\r\n+      _controller.stop();\r\n+      _controller.reset();\r\n+    }\r\n+  }\r\n+\r\n+  @override\r\n+  void dispose() {\r\n+    _controller.dispose();\r\n+    super.dispose();\r\n+  }\r\n+\r\n+  @override\r\n+  Widget build(BuildContext context) {\r\n+    return AnimatedBuilder(\r\n+      animation: _animation,\r\n+      builder: (context, child) {\r\n+        return Container(\r\n+          width: 40,\r\n+          height: 40,\r\n+          decoration: BoxDecoration(\r\n+            shape: BoxShape.circle,\r\n+            color: Colors.blue.withValues(alpha: 0.2 / _animation.value),\r\n+          ),\r\n+          child: Center(\r\n+            child: Container(\r\n+              width: 20,\r\n+              height: 20,\r\n+              decoration: BoxDecoration(\r\n+                color: Colors.blue,\r\n+                shape: BoxShape.circle,\r\n+                border: Border.all(color: Colors.white, width: 3),\r\n+                boxShadow: [\r\n+                  BoxShadow(\r\n+                    color: Colors.blue.withValues(alpha: 0.4),\r\n+                    blurRadius: 8,\r\n+                    spreadRadius: 2,\r\n+                  ),\r\n+                ],\r\n+              ),\r\n+            ),\r\n+          ),\r\n+        );\r\n+      },\r\n+    );\r\n+  }\r\n+}\n\\ No newline at end of file\n"
                }
            ],
            "date": 1765222324869,
            "name": "Commit-0",
            "content": "import 'package:flutter/material.dart';\r\nimport 'package:flutter_map/flutter_map.dart';\r\nimport 'package:latlong2/latlong.dart';\r\nimport '../utils/constants.dart';\r\n\r\nclass LiveMapWidget extends StatelessWidget {\r\n  final List<LatLng> trackPoints;\r\n  final LatLng? currentLocation;\r\n  final bool isTracking;\r\n  final MapController? mapController;\r\n\r\n  const LiveMapWidget({\r\n    super.key,\r\n    required this.trackPoints,\r\n    this.currentLocation,\r\n    this.isTracking = false,\r\n    this.mapController,\r\n  });\r\n\r\n  @override\r\n  Widget build(BuildContext context) {\r\n    final center = currentLocation ?? \r\n        (trackPoints.isNotEmpty ? trackPoints.last : const LatLng(9.0, 38.75)); // Default: Addis Ababa\r\n\r\n    return FlutterMap(\r\n      mapController: mapController,\r\n      options: MapOptions(\r\n        initialCenter: center,\r\n        initialZoom: 18.0,\r\n        maxZoom: 22.0,\r\n        minZoom: 10.0,\r\n      ),\r\n      children: [\r\n        // OpenStreetMap tiles\r\n        TileLayer(\r\n          urlTemplate: 'https://tile.openstreetmap.org/{z}/{x}/{y}.png',\r\n          userAgentPackageName: 'com.example.soil_sense',\r\n          maxZoom: 22,\r\n        ),\r\n        \r\n        // Polygon fill (if we have enough points)\r\n        if (trackPoints.length >= 3)\r\n          PolygonLayer(\r\n            polygons: [\r\n              Polygon(\r\n                points: trackPoints,\r\n                color: AppColors.primary.withOpacity(0.2),\r\n                borderColor: AppColors.primary,\r\n                borderStrokeWidth: 3,\r\n                isFilled: true,\r\n              ),\r\n            ],\r\n          ),\r\n        \r\n        // Track line\r\n        if (trackPoints.length >= 2)\r\n          PolylineLayer(\r\n            polylines: [\r\n              Polyline(\r\n                points: trackPoints,\r\n                color: AppColors.primary,\r\n                strokeWidth: 4,\r\n              ),\r\n            ],\r\n          ),\r\n        \r\n        // Track points markers\r\n        MarkerLayer(\r\n          markers: [\r\n            // Start point (green)\r\n            if (trackPoints.isNotEmpty)\r\n              Marker(\r\n                point: trackPoints.first,\r\n                width: 30,\r\n                height: 30,\r\n                child: Container(\r\n                  decoration: BoxDecoration(\r\n                    color: Colors.green,\r\n                    shape: BoxShape.circle,\r\n                    border: Border.all(color: Colors.white, width: 3),\r\n                    boxShadow: [\r\n                      BoxShadow(\r\n                        color: Colors.black.withOpacity(0.3),\r\n                        blurRadius: 4,\r\n                        offset: const Offset(0, 2),\r\n                      ),\r\n                    ],\r\n                  ),\r\n                  child: const Icon(\r\n                    Icons.play_arrow,\r\n                    color: Colors.white,\r\n                    size: 16,\r\n                  ),\r\n                ),\r\n              ),\r\n            \r\n            // Intermediate points\r\n            ...trackPoints.skip(1).take(trackPoints.length - 2).map(\r\n              (point) => Marker(\r\n                point: point,\r\n                width: 16,\r\n                height: 16,\r\n                child: Container(\r\n                  decoration: BoxDecoration(\r\n                    color: AppColors.primary,\r\n                    shape: BoxShape.circle,\r\n                    border: Border.all(color: Colors.white, width: 2),\r\n                  ),\r\n                ),\r\n              ),\r\n            ),\r\n            \r\n            // Current location (blue pulsing)\r\n            if (currentLocation != null)\r\n              Marker(\r\n                point: currentLocation!,\r\n                width: 40,\r\n                height: 40,\r\n                child: _PulsingLocationMarker(isTracking: isTracking),\r\n              ),\r\n          ],\r\n        ),\r\n      ],\r\n    );\r\n  }\r\n}\r\n\r\nclass _PulsingLocationMarker extends StatefulWidget {\r\n  final bool isTracking;\r\n  \r\n  const _PulsingLocationMarker({required this.isTracking});\r\n\r\n  @override\r\n  State<_PulsingLocationMarker> createState() => _PulsingLocationMarkerState();\r\n}\r\n\r\nclass _PulsingLocationMarkerState extends State<_PulsingLocationMarker>\r\n    with SingleTickerProviderStateMixin {\r\n  late AnimationController _controller;\r\n  late Animation<double> _animation;\r\n\r\n  @override\r\n  void initState() {\r\n    super.initState();\r\n    _controller = AnimationController(\r\n      duration: const Duration(seconds: 1),\r\n      vsync: this,\r\n    );\r\n    _animation = Tween<double>(begin: 1.0, end: 1.5).animate(\r\n      CurvedAnimation(parent: _controller, curve: Curves.easeInOut),\r\n    );\r\n    \r\n    if (widget.isTracking) {\r\n      _controller.repeat(reverse: true);\r\n    }\r\n  }\r\n\r\n  @override\r\n  void didUpdateWidget(_PulsingLocationMarker oldWidget) {\r\n    super.didUpdateWidget(oldWidget);\r\n    if (widget.isTracking && !_controller.isAnimating) {\r\n      _controller.repeat(reverse: true);\r\n    } else if (!widget.isTracking && _controller.isAnimating) {\r\n      _controller.stop();\r\n      _controller.reset();\r\n    }\r\n  }\r\n\r\n  @override\r\n  void dispose() {\r\n    _controller.dispose();\r\n    super.dispose();\r\n  }\r\n\r\n  @override\r\n  Widget build(BuildContext context) {\r\n    return AnimatedBuilder(\r\n      animation: _animation,\r\n      builder: (context, child) {\r\n        return Container(\r\n          width: 40,\r\n          height: 40,\r\n          decoration: BoxDecoration(\r\n            shape: BoxShape.circle,\r\n            color: Colors.blue.withOpacity(0.2 / _animation.value),\r\n          ),\r\n          child: Center(\r\n            child: Container(\r\n              width: 20,\r\n              height: 20,\r\n              decoration: BoxDecoration(\r\n                color: Colors.blue,\r\n                shape: BoxShape.circle,\r\n                border: Border.all(color: Colors.white, width: 3),\r\n                boxShadow: [\r\n                  BoxShadow(\r\n                    color: Colors.blue.withOpacity(0.4),\r\n                    blurRadius: 8,\r\n                    spreadRadius: 2,\r\n                  ),\r\n                ],\r\n              ),\r\n            ),\r\n          ),\r\n        );\r\n      },\r\n    );\r\n  }\r\n}"
        }
    ]
}